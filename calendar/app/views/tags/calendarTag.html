*{ this tag shows a simple calendar in a month view 
	requiered parameters for this tag are:
		- aDate
		- aLocale
}*
#{stylesheet 'calendar.css' /}
%{
	/*
	 * this code below, handles all the date arithmetic
	 */
	//transform aDate to a joda time date (aJodaDate)
	org.joda.time.DateTime aJodaDate = new org.joda.time.DateTime(_aDate);	
	
	//get a list of all days of a week
	org.joda.time.DateTime.Property propertyOfWeek = aJodaDate.dayOfWeek();
	String[] daysOfWeek = new String[propertyOfWeek.getMaximumValue()];
	
	//create an array of days of a week
	for(int i = 0; i < daysOfWeek.length; i++){
		daysOfWeek[i] = aJodaDate.withDayOfWeek(i+1).toString('E',_aLocale);
	}
	
	//get today as int
	org.joda.time.DateTime now = new org.joda.time.DateTime();
	int today = now.dayOfMonth().get();
	
	//get selected day as int
	int selectedDay = aJodaDate.dayOfMonth().get();
	
	//constraints...
	int maxDaysOfMonth = aJodaDate.dayOfMonth().getMaximumValue();
	//get the first day of the month as int. Ex.: monday = 1, etc...
	int startDay = aJodaDate.withDayOfMonth(1).dayOfWeek().get();
	
	//create field of days for the calendartable
	int dayOfMonth = 1;
	String[] dayFields = new String[42];
	
	for(int i = 0; i < dayFields.length; i++) {
		if(i>=(startDay-1) && dayOfMonth <=maxDaysOfMonth){
			dayFields[i] = ""+dayOfMonth;
			dayOfMonth++;
		} else {
			dayFields[i] = "#";
		}
	}
}%
<p>
<div id="calendarheader">
	#{list items:daysOfWeek, as:'dayOfWeek'}
   			<div id="dayfield"> ${dayOfWeek} </div>
	#{/list}
</div>

<div id="calendartable">
	#{list items:dayFields, as:'dayField'}
   			<div id="dayfield"> ${dayField} </div>
	#{/list}
</div>

<div id="calendarend"></div>
</p>